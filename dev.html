<!DOCTYPE html>
<html>

<head>
    <title>Order Form</title>
</head>

<body>
    <h1>Order Details</h1>
    <form id="orderForm">
        <label for="customerName">Customer Name:</label>
        <input type="text" id="customerName" required><br>

        <label for="customerName">Customer Phonenumber:</label>
        <input type="text" id="phone" required><br>

        <label for="customerName">Customer Email:</label>
        <input type="text" id="email" required><br>

        <label for="product">Product:</label>
        <input type="text" id="product" required><br>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" required><br>

        <label for="location">Delivery Location:</label>
        <input type="text" id="location" required><br>

        <label for="date">Date:</label>
        <input type="date" id="date" required><br>

        <button type="button" id="submitOrder">Submit Order</button>
    </form>
    <script src="airtable.browser.js"></script>
    <script>
        // Wrap your JavaScript code in a DOMContentLoaded event listener
        document.addEventListener('DOMContentLoaded', function () {
            const orders = [];

            document.getElementById('submitOrder').addEventListener('click', function () {
                const customerName = document.getElementById('customerName').value;
                const customerEmail = document.getElementById('email').value;
                const customerPhone = document.getElementById('phone').value;
                const product = document.getElementById('product').value;
                const quantity = document.getElementById('quantity').value;
                const location = document.getElementById('location').value;
                const date = document.getElementById('date').value;

                const trackingId = generateUniqueTrackingId();

                var Airtable = require('airtable');
                Airtable.configure({
                    endpointUrl: 'https://api.airtable.com',
                    apiKey: 'patGundcRK2hueu0r.b26856f970932fcc08709b6aef7da1a661745cc157531cf13ccc62aad7a819ca'
                });
                var base = new Airtable.base('app5QGPm12GFemcQ2');

                base('Order Details').create([
                    {
                        "fields": {
                            Tracking_ID: trackingId,
                            Customer_Name: customerName,
                            Customer_Email: customerEmail,
                            Customer_Phone_Number: customerPhone,
                            Product_Name: product,
                            Product_Quantity: quantity,
                            Delivery_Location: location,
                            Delivery_Date: date,
                        }
                    },
                ], function (err, records) {
                    if (err) {
                        console.error(err);
                        return;
                    }
                    records.forEach(function (record) {
                        console.log(record.getId());
                    });
                });
            });

            function generateUniqueTrackingId() {
                const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
                const idLength = 12;

                while (true) {
                    let trackingId = '';
                    for (let i = 0; i < idLength; i++) {
                        const randomIndex = Math.floor(Math.random() * characters.length);
                        trackingId += characters.charAt(randomIndex);
                    }

                    // Check if the tracking ID is unique
                    if (!orders.some(order => order.trackingId === trackingId)) {
                        return trackingId;
                    }
                }
            }

        });
    </script>
</body>

</html>